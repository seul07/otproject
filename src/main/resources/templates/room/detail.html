<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout/header::head"></head>
<body>

<nav class="navbar navbar-inverse">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">orProject</a>
        </div>
        <div class="collapse navbar-collapse" id="myNavbar">
            <ul class="nav navbar-nav">
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="#" th:text="${userId}"> </a></li>
            </ul>
        </div>
    </div>
</nav>

<div class="container-fluid text-center">
    <input name="userId" type="hidden" th:value="${userId}">
    <div class="row content">
        <div class="col-sm-2 sidenav">
        </div>
        <div class="col-sm-8 text-left">
            <div style="margin-top:150px;margin-left:30%">
                <p class="select-text">남/여</p>
                <div style="">
                    남<input type="radio" name="type" onchange="changeType(this)" th:value="M"  checked>
                    여<input type="radio" name="type" onchange="changeType(this)" th:value="W" >
                </div>
<!--                <select name="type" class="form-control" style="width:25%">-->
<!--                    <option value="">선택하시오.</option>-->
<!--                    <option value="M">남</option>-->
<!--                    <option value="W">여</option>-->
<!--                </select>-->
                <p class="select-text">층수</p>
                <select name="floor" class="form-control" style="width:25%">
                    <option value="">선택하시오.</option>
                </select>
            </div>

            <hr>

            <div style="margin-top:10px;margin-left:30%">
                <div id="rooms">


                </div>
            </div>







        </div>
        <div class="col-sm-2 sidenav">
            <div class="well">
            </div>
            <div class="well">
            </div>
        </div>
    </div>
</div>

<footer class="container-fluid text-center">
    <p></p>
</footer>

<!--<div class="header">-->
<!--    <div>-->
<!--        <a class="navbar-brand" href="#">otProject</a>-->
<!--    </div>-->
<!--    <div class="navbar-right">-->
<!--        <a th:text="${userId}"></a>-->
<!--    </div>-->
<!--</div>-->
<!--<div class="contents">-->
<!--    <div class="col-sm-2 sidenav"></div>-->
<!--    <div class="col-sm-8 text-left">-->
<!--        남/여-->
<!--        <select name="type">-->
<!--            <option value="">선택하시오.</option>-->
<!--            <option value="W">여</option>-->
<!--            <option value="M">남</option>-->
<!--        </select>-->
<!--        층수-->
<!--        <select name="floor">-->

<!--        </select>-->

<!--        <div id="rooms">-->


<!--        </div>-->
<!--    </div>-->
<!--    <div class="col-sm-2 sidenav"></div>-->
<!--</div>-->
<!--<div class="footer">-->

<!--</div>-->
</body>
<script>

    init();

    function init(){
        let userId = document.querySelector("input[name=userId]").value;
        let type = document.querySelector("input[name=type]").value;
        if(type==""){
            return;
        }
        getFloorList(type,userId)
            .then(response => {
                let html = setFloor(response.data);
                document.querySelector("select[name=floor]").innerHTML = html;
            })

    }

    let userId = document.querySelector("input[name=userId]").value;
    function changeType(current){
        let type = current.value;
        if(type==""){
            return;
        }

        getFloorList(type,userId)
            .then(response => {
                let html = setFloor(response.data);
                document.querySelector("select[name=floor]").innerHTML = html;
            })

    }

    function getFloorList(type,userId){
        return axios.get( "/user/floor/"+userId+"/"+type);
    }

    function setFloor(floors){
        let html = '<option>선택하세요.</option>';
        if(floors==null || floors.length==0) return html;
        floors.forEach((floor, index) => {
            html += `
             <option value${floor}>${floor}</option>
            `
        });
        return html;
    }

    document.querySelector('select[name=floor]').addEventListener('change',  () => {
        let type = document.querySelector("input[name=type]:checked").value;
        let floor = document.querySelector("select[name=floor] option:checked").value;
        if(!floor){
            return;
        }

        setRoomList(type,floor);

    });

    function setRoomList(type,floor){
        getRoomList(type,floor,userId)
            .then(response => {
                let html = setRooms(response.data);
                document.querySelector("#rooms").innerHTML = html;
            })
    }

    function getRoomList(type,floor,userId){
        return axios.get( "/user/room/"+userId+"/"+type+"/"+floor);
    }

    function setRooms(rooms){
        let html = '';
        if(rooms==null || rooms.length==0) return html;
        rooms.forEach((room, index) => {
            html += `
             <div data-room="${room.roomNumber}" data-id="${room.id}" data-occupy="${room.occupy}" class="room-block ${room.occupy == 'Y' ? 'active' : ''}"></div>
            `
        });
        return html;
    }

    let rooms = document.querySelectorAll(".room-block");

    document.querySelector('#rooms').addEventListener('click', function(e) {
        e.preventDefault();
        let ele = e.target;
        let roomNum = ele.dataset.room;
        let occupy = ele.dataset.occupy;
        let id = ele.dataset.id;
        let newOccupy = '';
        if(occupy=='Y'){
            newOccupy = 'N';
        }else{
            newOccupy = 'Y';
        }
        updateRoomOccupy(id,userId,newOccupy)
            .then(response => {
                let type = document.querySelector("input[name=type]").value;
                let floor = document.querySelector("select[name=floor] option:checked").value;
                setRoomList(type,floor);

            })
    });

    function updateRoomOccupy(id,userId,newOccupy){
        return axios.get( "/user/room/update/"+userId+"/"+id+"/"+newOccupy);
    }

</script>
<style>
    #rooms{display: flex}
    .room-block{
        width: 50px;
        height: 50px;
        border: #1a1a1a thin;
        background: #ced4da;
        margin : 2px;
    }

    .active{
        background: #ffc720;
    }

    .select-text{
        padding: 5px;
        font-size: 16px;
    }
</style>
</html>
